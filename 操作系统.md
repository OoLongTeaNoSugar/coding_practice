<!--
 * @Author: Zhanglei
 * @Date: 2021-12-23 20:08:48
 * @LastEditors: Zhanglei
 * @LastEditTime: 2021-12-25 01:24:39
 * @Description: file content
-->




# 操作系统

## **1、进程和线程**是什么？

- 进程是资源调度的基本单元，一个可执行程序可以创建一个或者多个进程
- 线程是程序执行的基本单元，是轻量化的进程，一个进程包含主线程和其他线程，进程依赖主线程，主线程结束意味进程结束


## **2、线程的特点**：

- 轻量化的进程，开销小，运行快
- 需要处理数据一致性问题（安全性？）
- 线程内共享堆、变量、文件等

## 3、线程和进程模型

### 多线程：

同一个进程内的线程共享该进程下的内存空间，定义的全局变量所有线程均可以读取、修改。
- 但是，**做一次简单的i = i + 1在计算机中并不是原子操作，涉及内存取数，计算和写入内存几个环节**，而线程的切换有可能发生在上述任何一个环节中间，所以不同的操作顺序很有可能带来意想不到的结果。

因为顺序不可控，所以线程安全性很重要。

- 创建线程
  - `int pthread_create(pthread_t pthread, const pthread_attr_t *attr, void *(start_routine)(void *), void *agr);`
  - 创建线程
  - 获得线程tid
  - 结束线程

### 多进程：

进程有两种创建方式，一种是操作系统创建的一种是父进程创建的。从计算机启动到终端执行程序的过程为：0号进程 -> 1号内核进程 -> 1号用户进程(init进程) -> getty进程 -> shell进程 -> 命令行执行进程。所以我们在命令行中通过 ./program执行可执行文件时，所有创建的进程都是shell进程的子进程，这也就是为什么shell一关闭，在shell中执行的进程都自动被关闭的原因。从shell进程到创建其他子进程需要通过以下接口。

## 4、一个程序编译过程

```mermaid
graph LR;
    预编译 --> 编译 --> 汇编 --> 链接
```

- 预编译：处理文件中带 `#` 的命令，删去注释等
- 编译：进行语义、语法分析、优化后，生成汇编代码文件
- 汇编：将代码文件转化为机器码文件，生成可执行文件`xxx.o`(linux)或`xxx.obj`(windows)。
- 链接：
  - **静态链接：**
  
    将函数和数据编译进一个二进制文件，链接从库中将函数、数据复制与应用该函数的程序打包成一个二进制文件。
    - 缺点：
      - 1、空间浪费，大量重复函数占用重复空间
      - 2、更新困难，更新函数时，需要重新编译所有文件

    - 优点：运行速度快
  
  - **动态链接：**

    将函数作为动态库调用，程序运行时才将他们链接在一起。
    
    优缺点正好相反，共享库节省了空间，容易更新，但却造成性能损耗。

